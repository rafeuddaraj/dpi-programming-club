// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  ACTIVE
  RESTRICTED
  BANNED
  EXPIRED
  PROCESSING
  EX
}

model User {
  id                    String                 @id @default(auto()) @map("_id") @db.ObjectId
  name                  String
  email                 String                 @unique
  password              String
  phoneNumber           String                 @unique
  gender                String
  avatar                String?
  semester              String
  coverImage            String?
  session               String
  department            String
  rollNo                String
  skills                String[]               @default([])
  registrationNo        String
  discord               String?
  bio                   String?
  about                 String?
  linkedin              String?
  github                String?
  shift                 String
  role                  String                 @default("member") // member, moderator, admin
  address               String?
  status                UserStatus             @default(PROCESSING)
  renewalDate           DateTime
  renewalFee            Int                    @default(50)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt()
  token                 Session[]
  Payment               Payment[]
  gallery               Gallery[]
  EventParticipant      EventParticipant[]
  workshopParticipants  WorkshopParticipant[]
  eventExaminers        EventParticipant[]     @relation("Examiner")
  examiners             AssignmentSubmission[] @relation("Examiner")
  assignmentSubmissions AssignmentSubmission[]
  quizResults           QuizResults[]
}

model Session {
  id           String @id @default(auto()) @map("_id") @db.ObjectId
  accessToken  String
  refreshToken String
  userId       String @unique @db.ObjectId
  user         User   @relation(fields: [userId], references: [id])
}

enum EventType {
  OFFLINE
  ONLINE
}

model Event {
  id                   String             @id @default(auto()) @map("_id") @db.ObjectId
  name                 String
  description          String
  startTime            DateTime
  endTime              DateTime
  type                 EventType          @default(OFFLINE) // Offline Or Online 
  location             String // If Online Store Meeting Link else Offline Store Location 
  curriculums          String[]
  author               String // Organizers
  authorsDetails       Json? // Organizers Details
  price                Int? // If Premium Event for need Price
  availableSeat        Int? // Event Set
  registrationDeadline DateTime?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt()
  EventParticipant     EventParticipant[]
}

model EventParticipant {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  eventId       String   @db.ObjectId
  event         Event    @relation(fields: [eventId], references: [id])
  participantId String   @db.ObjectId
  score         Int?
  complete      Boolean  @default(false)
  certificate   String?
  feedback      String?
  participant   User     @relation(fields: [participantId], references: [id])
  joining       DateTime @default(now())
  paymentId     String?  @db.ObjectId
  payment       Payment? @relation(fields: [paymentId], references: [id])
  examinerId    String?  @db.ObjectId
  examiner      User?    @relation("Examiner", fields: [examinerId], references: [id])

  // @@unique([eventId, participantId])
}

enum ActivityType {
  OFFLINE
  ONLINE
}

model Workshop {
  id                   String                @id @default(auto()) @map("_id") @db.ObjectId
  name                 String
  description          String
  outline              String[]
  registrationDeadline DateTime
  startingDate         DateTime
  endingDate           DateTime
  price                Int?
  type                 ActivityType          @default(OFFLINE)
  totalSeats           Int? // if offline mention it. otherwise not need. 
  instructor           String? // Instructor name
  instructorDetails    String? // Instructor Details
  instructorUrl        String? // Instructor Details or portfolio or Profile
  isActive             Boolean               @default(false) // status
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt()
  modules              WorkshopModule[]
  participants         WorkshopParticipant[]
}

model WorkshopModule {
  id           String           @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  description  String?
  workshopId   String           @db.ObjectId
  workshop     Workshop         @relation(fields: [workshopId], references: [id])
  lessons      WorkshopLesson[]
  isActive     Boolean          @default(false)
  position     Int              @default(0)
  startingDate DateTime
  endingDate   DateTime
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt()
}

model WorkshopLesson {
  id               String         @id @default(auto()) @map("_id") @db.ObjectId
  name             String
  description      String?
  liveLink         String? // This is Live Link for Online workshop 
  recordedLink     String? // This is Online workshop recorded link 
  location         String? // This is only use to Offline workshop
  workshopModuleId String         @db.ObjectId
  module           WorkshopModule @relation(fields: [workshopModuleId], references: [id])
  isActive         Boolean        @default(false)
  position         Int            @default(0)
  startingDate     DateTime
  endingDate       DateTime
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt()
}

model WorkshopParticipant {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  workshopId    String   @db.ObjectId
  workshop      Workshop @relation(fields: [workshopId], references: [id])
  participantId String   @db.ObjectId
  participant   User     @relation(fields: [participantId], references: [id])
  price         Int?
  score         Int? // - update
  complete      Boolean  @default(false) // - update
  certificate   String? // - update
  feedback      String? // - update
  paymentId     String   @db.ObjectId
  lastModuleId  String?  @db.ObjectId
  lastLessonId  String?  @db.ObjectId
  payment       Payment? @relation(fields: [paymentId], references: [id])
  joining       DateTime @default(now())
}

// Payments

model Payment {
  id                  String                @id @default(auto()) @map("_id") @db.ObjectId
  userId              String                @db.ObjectId
  user                User                  @relation(fields: [userId], references: [id])
  amount              Int
  paymentMethod       String
  paymentDetails      String
  accountNo           String
  registrationFee     Boolean               @default(false)
  paymentStatus       Boolean               @default(false)
  transactionId       String
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt()
  EventParticipant    EventParticipant[]
  WorkshopParticipant WorkshopParticipant[]
}

model Gallery {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  creatorId   String   @db.ObjectId
  creator     User     @relation(fields: [creatorId], references: [id])
  title       String
  description String
  images      String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt()
}

// Assignments 

enum ASSIGNABLE_TYPES {
  Workshop
}

model Assignments {
  id             String                 @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  description    String
  assignableType ASSIGNABLE_TYPES
  totalMarks     Int                    @default(100)
  submissions    AssignmentSubmission[]
  deuDate        DateTime
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt()
  relatedId      String                 @db.ObjectId // ID of the related entity (e.g., Workshop ID or Course ID)
}

model AssignmentSubmission {
  id             String      @id @default(auto()) @map("_id") @db.ObjectId
  userId         String      @db.ObjectId
  submissionDate DateTime    @default(now())
  marks          Int? // Null if not marked yet
  feedback       String? // Feedback from the Admin/Moderator
  assignmentId   String      @db.ObjectId
  assignment     Assignments @relation(fields: [assignmentId], references: [id])
  user           User        @relation(fields: [userId], references: [id])
  examiner       User        @relation("Examiner", fields: [id], references: [id]) // reviews
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt()
}

// Quizzes

model Quizzes {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String
  totalMarks  Int      @default(100)
  duration    Int // Duration in minutes
  isActive    Boolean  @default(false)
  startTime   DateTime // When the quiz will be available
  endTime     DateTime // When the quiz will end
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt()

  questions QuizQuestions[]
  results   QuizResults[]
  links     QuizLinks[]
}

model QuizQuestions {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  quizId       String   @db.ObjectId
  question     String
  options      String[] // ["Option 1", "Option 2", "Option 3", "Option 4"]
  isActive     Boolean  @default(false)
  correctIndex Int // Index of the correct answer in the options array
  marks        Int // Marks for this question
  quiz         Quizzes  @relation(fields: [quizId], references: [id])
}

model QuizResults {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  quizId      String   @db.ObjectId
  userId      String   @db.ObjectId
  score       Int
  completedAt DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt()
  quiz        Quizzes  @relation(fields: [quizId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
}

model QuizLinks {
  id        String       @id @default(auto()) @map("_id") @db.ObjectId
  quizId    String       @db.ObjectId
  type      ActivityType // "Workshop", "Course", etc.
  relatedId String       @db.ObjectId // ID of the related entity (e.g., Workshop ID or Course ID)
  quiz      Quizzes      @relation(fields: [quizId], references: [id])
}
